## 군집화(Clustering)

### 군집화의 이해

데이터 포인트들을 별개의 군집으로 그룹화 하는 것을 의미합니다.

유사성이 높은 데이터들을 동일한 그룹으로 분류하고 서로 다른 군집들이 상이성을 가지도록 그룹화합니다.

<img width="478" alt="cluster_img" src="https://user-images.githubusercontent.com/70785000/134755470-357e881d-5f5f-4d56-8f5e-baa6e9de1b58.png">

### 군집화 활용 분야

* 고객, 마켓, 브랜드 및 사회 경제 활동 등 전분야에 걸쳐서 세분화(Segmentation)
* Image검출, 세분화, 트랙킹
* 이상 검출(Abnormaly detection)

어떤 요소들을 유사성으로 정의할 것인가가 중요판단 요소로 작용함.

### 군집화 알고리즘

* K-Means - Centroid기반의 알고리즘 가장 많이 활용
* Mean Shift - Centroid기반인데 KMeans와는 조금 다르게 중심정이 이동하는 것이 차이가 있음
* Gaussian Mixture Model - 데이터가 여러 개의 정규분포로 되어있고 가정하고, 이 데이터세트가 어느 정규분포에 속하는지에 따라 클러스터링 수행
* DBSCAN - 데이터의 밀도에 따라서 군집화를 수행하는 알고리즘

#### K-Means Clustering

군집중심점(Centroid)기반 클러스터링

![K평균군집_동작시각화](https://user-images.githubusercontent.com/70785000/133865224-74a2f128-ce8b-42f9-9709-cfb5b9ebbd9b.png)

> 유클리디안 거리를 구해 중심점을 이동하였지만 데이터들의 중심점 소속 변경이 없으면 군집화가 완료됨

#### 장점

* 일반적인 군집화에서 가장 많이 활용되는 알고리즘.비즈니스의 고객 세분화에서 많이 활용
* 알고리즘이 쉽고 간결
* 대용량 데이터에도 활용이 가능

#### 단점

* 거리 기반 알고리즘으로 속성의 갯수가 매우 많을 경우 **군집화 정확도**가 떨어집니다.(이를 위해 PCA로 차원 축소를 적용해야 할수도있음), 가까운 거리에 있는 데이터는 군집화가 되는 거리기반 알고리즘.
* 반복을 수행하는데, 반복 횟수가 많을 경우 수행 시간이 느려짐
* 이상치 데이터에 취약(유클리디안 거리계산이기때문에 극단적으로 작거나 큰 값이 있다면)

### 사이킷런 KMean클래스

사이킷런 패키지는 K-평균을 구현하기 위해 KMeans클래스를 제공합니다. KMeans클래스는 다음과 같은 초기화 파라미터를 가지고있습니다.

> class sklearn.cluster.KMeans(n_clusters=8, init='k-means++', n_init=10, max_iter=300, tol=0.0001, precompute_distances='auto', verbose=0, random_state=None, copy_x=True, n_jobs=1, algorithm='auto')

`n_clusters` - 중심점갯수를 설정, `init`:KMeans초기화 알고리즘, `max_iter :` 최대반복횟수

#### 주요 파라미터

* KMeans초기화 파라미터 중 가장 중요한 파라미터는 `n_cluster`이며, 이는 군집화 개수 , 즉 준집 중심점 갯수를 의미
* `init`는 초기에 군집 중심점의 좌표를 설정할 방식을 말하며 보통은 임의로 중심을 설정하지 않고 일반적으로 `k-means++`방식으로 최초 설정
* `max_iter`는 최대 반복 횟수이며, 이 횟수 이전에 모든 데이터의 중심점이 이동이 없으면 종료합니다.

#### 주요 속성

* `labels_` : 각 데이터 포인트가 속한 군집 중심점 레이블
* `cluster_centers_`: 각 군집 중심점 좌표(Shape)는  `군집 갯수, 피처갯수` . 이를 이용하면 군집 중심점 좌표가 어디인지 시각화가 가능

### 군집평가 - 실루엣 분석

> * 다른 군집과의 거리는 떨어져 있고 동일 군집끼리의 데이터는 서로 가깝게. 즉 이 의미는 동일 군집내에서의 `집단간의 동질성`은 아주 가깝게, 다른 군집간의 `집단간의 이질성`은 더 멀게 라는 의미.
> * [관련 글 참조](https://m.blog.naver.com/jinty/221719520925)

<img width="287" alt="군집평가" src="https://user-images.githubusercontent.com/70785000/134761466-360d1fd9-21c3-4874-b4bc-3fe7e9147876.png">

* 실루엣 분석은 각 군집 간의 거리가 얼마나 효율적으로 분리돼 있는지를 나타냅니다.
* 실루엣 분석은 개별 데이터가 가지는 군집화 지표인 실루엣 계수를 기반으로 합니다.
* 개별 데이터가 가지는 실루엣 계수는 해당 데이터가 같은 군집내의 데이터와 얼마나 가깝게 군집화돼 있고, 다른 군집에 있는 데이터와는 얼마나 멀리 분리돼 있는지를 나타내는 지표

#### 실루엣 계수

<img width="380" alt="실루엣계수" src="https://user-images.githubusercontent.com/70785000/134763623-149db586-443e-4d1f-86a1-20366d157898.png">

* aij는 i번째 데이터에서 자신이 속한 클러스터내의 다른 데이터 포인트까지의 거리. 즉, a12는 1번 데이터에서 2번 데이터까지의 거리

* a(i)는 i번째 데이터에서 자신이 속한 클러스터내의 다른 데이터 포인트의 평균거리. 즉, a(i) = 평균(a12, a13, a14)

* b(i)는 i번째 데이터에서 가장 가까운 타 클러스터내의 다른 데이터 포인트들의 평균 거리.

  즉, b(i) = 평균(b15, b16, b17, b18)

* 두 군집 간의 거리가 얼마나 떨어져 있는가의 값은 b(i) - a(i) 이며 이 값을 정규화하기 위해 MAX(a(i), b(i)) 값으로 나눕니다.

* 실루엣 계수는 -1에서 1 사이의 값을 가지며, 1로 가까워질수록 근처의 군집과 더 멀리 떨어져 있다는 것이고, 0에 가까울수록 근처의 군집과 가까워진다는 것입니다. `-` 값은 아예 다른 군집에 데이터 포인트가 할당됐음을 뜻합니다.

$$
s(i) = \frac {(b(i) - a(i))} { (max(a(i), b(i)))}
$$

